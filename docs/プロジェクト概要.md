# プロジェクト概要

## サイト情報

- **サイト名**: Uenishi.Web
- **概要**: 大阪に生息しているWebアプリケーション開発者のブログ
- **著者**: Keita Uenishi（1992年9月5日生まれ、28歳からエンジニア転向）
- **フレームワーク**: Astro 5.16.9（SSG - 静的サイト生成）
- **テーマ**: Bear Blog ベース

## 技術スタック

| レイヤー | 技術 |
|----------|------|
| **フレームワーク** | Astro 5.16.9 |
| **言語** | TypeScript (strict) |
| **スタイリング** | Tailwind CSS v4 + Typography プラグイン |
| **コンテンツ** | Markdown + MDX（カスタムプラグイン付き） |
| **コードハイライト** | astro-expressive-code |
| **アイコン** | Lucide（@iconify-json/lucide） |
| **ID生成** | Sqids |
| **画像処理** | Sharp |
| **フォント** | Atkinson Hyperlegible |
| **リンター** | ESLint 9 + 各種プラグイン |
| **フォーマッター** | Prettier 3 |

## 主要ディレクトリ構造

```
myblog/
├── src/
│   ├── assets/          # プレースホルダー画像（blog-placeholder-1〜5.jpg）
│   ├── components/      # 共通コンポーネント
│   ├── content/
│   │   └── blog/        # ブログ記事（Markdown）
│   │       ├── _draft/  # 下書き
│   │       ├── _template/ # テンプレート
│   │       └── _images/ # 記事用画像
│   ├── layouts/         # レイアウトテンプレート
│   ├── libs/            # ユーティリティ・Markdownプラグイン
│   ├── pages/           # ページルーティング
│   ├── scripts/         # ユーティリティスクリプト
│   ├── styles/          # グローバルCSS
│   ├── consts.ts        # サイト定数
│   └── content.config.ts # コンテンツスキーマ定義
├── public/
│   ├── fonts/           # Atkinson Hyperlegible（woff）
│   ├── images/          # プロフィール画像
│   └── favicon.svg
├── astro.config.ts
├── tsconfig.json
├── package.json
└── eslint.config.js
```

## ページルーティング

### `/` - トップページ（index.astro）
- 公開済みブログ記事の一覧表示
- 30件ごとのクライアントサイドページネーション
- 新しい順にソート

### `/about` - アバウトページ（about/index.astro）
- プロフィール画像・自己紹介
- SNSリンク（GitHub, X/Twitter, Zenn, LinkedIn, Wantedly, Speaker Deck）

### `/blog/[...id]` - ブログ記事ページ（blog/[...id].astro）
- Sqids IDベースの動的ルーティング
- `public: true` の記事のみ本番で表示（開発時は全記事表示）

### `/rss.xml` - RSSフィード（rss.xml.js）
- 全公開記事を含むRSSフィード自動生成

## コンポーネント

### `/src/components/`

| コンポーネント | 役割 |
|---------------|------|
| **BaseHead.astro** | `<head>` メタデータ・SEO・OGPタグ・フォントプリロード |
| **Header.astro** | ナビゲーションヘッダー（Home, About） |
| **HeaderLink.astro** | アクティブ状態検知付きナビリンク |
| **Footer.astro** | フッター（著作権表示・SNSリンク） |
| **FormattedDate.astro** | 日付フォーマット表示（YYYY.MM.DD形式） |
| **Pagination.astro** | クライアントサイドページネーション（URLパラメータ更新） |

## レイアウト

### `/src/layouts/`

| レイアウト | 用途 |
|-----------|------|
| **Layout.astro** | 汎用レイアウト（Header + Footer + max-w-3xl コンテナ） |
| **BlogPost.astro** | ブログ記事専用レイアウト（タイトル・日付・目次・prose スタイル） |

## ライブラリ・ユーティリティ

### `/src/libs/`

| ファイル | 機能 |
|---------|------|
| **blog.ts** | `getAllPublicBlogs()` - 公開記事取得・ソート、`formatDate()` - 日付フォーマット、`generateBlogPath()` - パス生成 |
| **generateId.ts** | Sqidsを使ったブログID生成（Unixタイムスタンプベース、最小6文字） |
| **remarkCallout.ts** | Obsidian互換のCallout記法変換（`> [!TYPE] Title` → 折りたたみ可能なCallout要素） |
| **rehypeInlineCodeStrong.ts** | インラインコード内の `**太字**` マーカー対応 |
| **rehypeRemoveDetailsOpen.ts** | Calloutの `<details>` から `open` 属性を除去（デフォルト折りたたみ） |

## コンテンツスキーマ

### ブログ記事のFrontmatter

```yaml
---
id: string          # Sqids生成の一意ID（必須）
title: string       # 記事タイトル（必須）
public: boolean     # 公開フラグ（必須）
publishedAt: date   # 公開日（必須）
editedAt: date?     # 編集日（任意）
description: string? # 概要（任意）
image: string?      # カバー画像（任意）
tags: string[]?     # タグ（任意）
category: string?   # カテゴリ（任意）
lang: string?       # 言語（任意）
---
```

## ブログコンテンツ

### 記事数
- **公開記事**: 約45本
- **下書き**: 2本（パスキー、Google Cloudパーティショニング）

### 主要カテゴリ・トピック
- **JavaScript基礎**: プロトタイプ、アロー関数、windowオブジェクト、非同期処理、Symbol、Proxy
- **Web技術**: HTTP/HTTPS、CORS、OAuth、DNS、SOP、プロキシ、キャッシュ
- **React / Next.js**: React.FC、TanStack Table、Next-Image、pageExtensions、NextAuth
- **TypeScript / C#**: LINQ、デリゲート、プロパティ、型安全
- **データベース**: Oracle SQL、オプティマイザ、ナチュラルキー/サロゲートキー
- **設計・アーキテクチャ**: DI、CSR/SSR/SSG/ISR、オブジェクト指向
- **インフラ・ツール**: GraphQL、Edge Runtime、MSW、dotenv
- **セキュリティ**: XSS、プロトタイプ汚染、Shibboleth、認証
- **書籍レビュー**: 「世界一流エンジニアの思考法」「現場で役立つシステム設計の原則」
- **振り返り**: 2021年、2023年

## スクリプト

### `/src/scripts/`

| スクリプト | 用途 |
|-----------|------|
| **generateSqidsId.js** | 新規記事用のSqids IDをCLIで生成 |
| **reverse-image-links.mjs** | 画像リンクのフォーマット変換（Obsidian → Astro） |
| **sync-file-dates-to-publishedAt.mjs** | ファイルの変更日時をfrontmatterの `publishedAt` に同期 |

## スタイリング

### テーマカラー
- **アクセント**: `#0066cc`（青）
- **アクセントダーク**: `#003d7a`
- **テキスト**: `#212529`
- **グレー**: `#666` / `#e5e9ec`

### カスタムスタイル（`global.css`）
- **proseクラス**: 記事本文用のカスタムスタイル（リンク色、見出し罫線、コードブロック、画像角丸、テーブル横スクロール）
- **Calloutスタイル**: 種類別カラー（note=青、tip=緑、warning=黄、danger=赤 等）
- **レスポンシブ**: 768px以下でフォントサイズ14px、パディング調整

## SEO・サイト機能

- **OGPタグ**: OpenGraph + Twitter Card メタタグ自動生成
- **Canonical URL**: 正規URL設定
- **Sitemap**: `@astrojs/sitemap` による自動生成
- **RSSフィード**: 全公開記事のフィード配信
- **目次**: h2/h3見出しから自動生成（BlogPostレイアウト）

## 開発コマンド

```bash
npm run dev       # 開発サーバー起動（localhost:4321）
npm run build     # 本番ビルド（./dist/）
npm run preview   # ビルドプレビュー
npm run lint      # ESLintチェック
npm run lint:fix  # ESLint自動修正
npm run format    # Prettierチェック
npm run format:fix # Prettier自動フォーマット
```

## コンテンツ作成ワークフロー

1. **執筆**: Obsidianで記事を執筆（`.obsidian/` 設定あり）
2. **ID生成**: `node src/scripts/generateSqidsId.js` でユニークIDを発行
3. **画像管理**: `_images/` ディレクトリに画像を配置、必要に応じてリンク変換スクリプトを実行
4. **公開管理**: frontmatterの `public: true/false` で公開・非公開を制御
5. **品質チェック**: `npm run lint` + `npm run format` で一貫性を担保
