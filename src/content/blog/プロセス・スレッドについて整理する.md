---
title: "プロセス・スレッドについて整理する"
id: r757ah6
public: false
publishedAt: 2025-01-06
editedAt: null
description: "この記事について 「プロセス」と「スレッド」って何がどう違うの？ と聞かれても答えられる気がしなかったので、改めて整理していくための記事です。深掘りではなく、あくまで概要把握と解説ができる、という感覚"
tags:
  - コンピュータ
  - 下書き
---


# この記事について

「プロセス」と「スレッド」って何がどう違うの？ と聞かれても答えられる気がしなかったので、改めて整理していくための記事です。深掘りではなく、あくまで概要把握と解説ができる、という感覚で記事を書いています。

個人的メモのため、参考にさせていただいた記事の図などを色々引用させていただいています。

# プログラムとは

そもそもの「プログラム」について。

プログラムとは、プログラミング言語で書かれた一連の命令のことです。ここで書かれたソースコードをコンピュータが理解できるバイナリコードに変換することで実行可能になります。

このバイナリコードへの変換は、以下の2つの方法で行われます。

- インタプリタによる逐次変換
    - ソースコードを1行ずつ、バイナリコードに変換しながら実行する
        - 文法ミスがあった場合は、ミスがあった行で処理がストップする
- コンパイラによる事前変換
    - 実際のソースコードを実行前に一括で変換する
        - 実行時の翻訳は不要なので、実行速度が速い

変換されたバイナリコードはメモリ上に展開され、CPUによって逐次実行されます。

memo

[https://jp.quora.com/C言語等で最終的に機械語バイナリを作り-CPUに実行させ](https://jp.quora.com/C言語等で最終的に機械語バイナリを作り-CPUに実行させ)

# プロセスとは

実行中のプログラムのインスタンスのこと。実行中のアプリケーションともいえます。

プログラムが実行されると、オペレーティングシステム (OS) によってプロセスが生成されます。

![](_images/Untitled%2020.png)

引用: [https://zenn.dev/antez/books/568dd4d86562a1/viewer/531a45#🚀プロセス(process)](https://zenn.dev/antez/books/568dd4d86562a1/viewer/531a45#%F0%9F%9A%80%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9(process))

プロセスは、プログラムの実行に必要な「リソース」を管理します。

プロセスを管理するリソースには以下のようなものがあります。

- コードセグメント（実行可能なコード）
- データセグメント（グローバル変数や静的変数）
- ヒープ（動的メモリ割り当て）
- スタック（ローカル変数、関数パラメータ、関数呼び出し
- レジスタ（CPUの高速な一時的データ格納場所）

![](_images/Untitled%2021.png)

引用: [https://zenn.dev/farstep/articles/process-thread-difference#プロセスとは](https://zenn.dev/farstep/articles/process-thread-difference#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%A8%E3%81%AF)

process1とprocess2はそれぞれ独立しており、異なるプロセスが同じメモリ上のデータにアクセスすることは基本的にありません。

## プロセスの状態

プロセスが実行される際に、状態というものが以下のように変わります。

- New（プロセスが新しく作られた状態）
- Running（指令が実行された状態）
- Waiting（プロセスが他のイベントが発動されるのを待っている状態）
- Ready（プロセスがプロセッサーに割り当てられるのを待っている状態）
- Terminated（プロセスの実行が終わった状態）

プロセスが使用していいメモリ領域は、OSによって管理されています。

以下のように各プロセスは別々のメモリ領域を使用し、基本的に共有することはありません（実際にはプロセスに対しては仮想アドレスが割り当てられ、物理アドレスと紐付けられますが、ここではかなり簡略化した図となっています）

// TODO: 仮想アドレスに関して深掘りして修正する

[https://zenn.dev/antez/books/568dd4d86562a1/viewer/531a45#🚀仮想アドレス](https://zenn.dev/antez/books/568dd4d86562a1/viewer/531a45#🚀仮想アドレス)

![](_images/Untitled%2022.png)

メモ帳に何かを書いたからといってWordにその変更が反映されることがないように、あるプロセスの処理は、他のプロセスに一切影響を与えないようになっています。

重要なのは、1つのプロセスだけがどんなプロセッサにおいてもRunning状態になることができるということです。

プロセッサとはCPUのことを指しており、CPUがひとつであればそれぞれの瞬間には1つのプロセスしか動いていない、ということになります。

しかし現在のPCやスマートフォンなどでは当たり前のように音楽を聴きながらインターネットを見たりなど、さまざまなことが同時進行で行えます。これは、現代OSにはマルチタスク（マルチプロセス）と呼ばれる機能を持っており、実際には実行するアプリケーションをものすごく細かく切り替えることで “同時に動いているように見せる” ことができるためです。

プロセスが実行している際に別のプロセスが実行されると、CPUは「コンテキスト」と呼ばれる現状のデータを保存します。各プロセスは、このコンテキストを保存・復帰しながら実行していきます。この動作を「コンテキストスイッチ」と呼びます。

このコンテキストスイッチが人間の目には見えないほどの速さで行われるため、交互に実行しているにも関わらず同時に動いているように見える、となっています。

### コンテキストスイッチについて

コンテキストスイッチはOSのカーネルによって行われます。

マルチプロセス（1リクエスト1プロセス方式）の場合、リクエストが増えるとプロセスも増えるため、コンテキストスイッチ（特にメモリ空間の切り替え）のコストが高くなります。

例 : Apache

コンテキストスイッチのコスト問題を解決する方法について

- シングルプロセス・マルチスレッド
    - コンテキストスイッチのコストは解消されるが、デメリットとしてファイルディスクリプターを消費してしまう
        - ファイルディスクリプタとは、プログラムからファイルを操作する際、操作対象のファイルを識別・同定するために割り当てられる番号のこと。OSにファイル操作を依頼する際に用いられる値で、通常は16ビット符号なし整数が用いられる。
[https://e-words.jp/w/ファイルディスクリプタ.html](https://e-words.jp/w/ファイルディスクリプタ.html)

- シングルプロセス・シングルスレッド
    - 処理するべきものがどんどんイベントキューに追加され、それらを全て1つのプロセスで捌く
    - ファイルアクセスや通信などのCPUを使わない処理は非同期で行われる
        - 処理が終わったらコールバック関数が呼ばれる
        - 例 : nginx, node.js

# スレッド

スレッドとは、プロセス内部での実行単位のことです。プロセスがスレッドを含んでいる。という関係になります。

プロセス間ではメモリが共有されませんが、スレッド間ではプロセス内のメモリ領域が共有されています。まるで1本の糸を手繰っていくように処理が進むことからThread（糸）と名付けられました。

![](_images/Untitled%2023.png)

スレッドには以下の2種類があります。

- シングルスレッドのプロセス
    - ひとつしかスレッドを持たないプロセスのことを指します
        - ひとつの処理の実行中には、後続の処理は一時停止する

- マルチスレッドのプロセス
    - 複数のスレッドを持つプロセスです
        - 「並列処理」の簡略化を可能とする
        - リソースの管理をしっかりと行わないと、再現性の低いバグを引き起こす可能性があるので、注意が必要
            - 全てのスレッドがそれぞれ別のスレッドの完了を待ち合って、結果的に全てのスレッドが停止してしまう「デッドロック」など
                - この危険性を排除するような設計を「スレッドセーフ」などと呼ぶ

[https://atmarkit.itmedia.co.jp/ait/articles/0503/12/news025.html](https://atmarkit.itmedia.co.jp/ait/articles/0503/12/news025.html)

## スレッドセーフ

マルチスレッドの実行環境でも大丈夫な設計を「スレッドセーフ」と呼びます。

例えば、複数のスレッドからアクセスされる可能性があっても、読み取りのみであれば問題ありません。逆に、値の変更が起こるようなリソースはスレッドセーフではなく、排他制御などによって管理しなければいけません。

排他制御は、あるスレッドがリソースにアクセスしている時は、他のスレッドがアクセスできないようにロックをかけることを指します。

要するに、「スレッドAが使用中」または「使用可能」といった情報を持ち、アクセスを制御することです。

こうすることで、1つのリソースに複数の書き込みが同時に起こることを防止します。

マルチスレッドに関してのメモ

![](https://x.com/ar04121191/status/1641589574983114752)


# 並行処理と並列処理

![](_images/Untitled%2024.png)

引用: [https://blog.framinal.life/entry/2020/04/05/204055](https://blog.framinal.life/entry/2020/04/05/204055)

### 並行処理 (**Concurrent processing)**

前述した

### 並列処理 (P**arallel processing)**



[https://blog.framinal.life/entry/2020/04/05/204055](https://blog.framinal.life/entry/2020/04/05/204055)

# 参考

[https://zenn.dev/farstep/articles/process-thread-difference#プロセスとは](https://zenn.dev/farstep/articles/process-thread-difference#プロセスとは)

[https://webpia.jp/thread_process/](https://webpia.jp/thread_process/)

[https://qr.ae/psBQjt](https://qr.ae/psBQjt)

[https://qiita.com/yokoto/items/3b4bcc489d93bc57baf3](https://qiita.com/yokoto/items/3b4bcc489d93bc57baf3)