---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";

import type { MarkdownHeading } from "astro";
import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"blog">["data"] & {
  headings: MarkdownHeading[];
};

const { title, description, publishedAt, editedAt, headings } = Astro.props;
---

<html lang="ja">
  <head>
    <BaseHead title={title ?? ""} description={description ?? ""} />
  </head>

  <body class="bg-white">
    <Header />
    <main class="mx-auto max-w-3xl px-4 py-12">
      <article>
        <div class="mb-8 text-center">
          <div class="text-gray mb-2">
            <FormattedDate date={publishedAt} />
            {
              editedAt && (
                <div class="italic">
                  更新日 <FormattedDate date={editedAt} />
                </div>
              )
            }
          </div>
          <h1 class="mb-4 text-3xl font-bold">{title}</h1>
          <hr class="border-gray-light" />
        </div>

        {
          headings && headings.length > 0 && (
            <nav class="toc bg-gray-light mb-8 rounded-lg p-6">
              <ul class="m-0 list-none p-0">
                {headings.map((heading) => (
                  <li
                    class="last:mb-0"
                    style={{ paddingLeft: `${(heading.depth - 2) * 1.5}rem` }}
                  >
                    <a
                      href={`#${heading.slug}`}
                      class="text-gray-dark hover:text-accent block rounded px-3 py-1 no-underline transition-colors duration-200 hover:bg-white"
                    >
                      {heading.text}
                    </a>
                  </li>
                ))}
              </ul>
            </nav>
          )
        }

        <div class="prose prose-zinc max-w-none">
          <slot />
        </div>
      </article>
    </main>
    <Footer />
    <script is:inline type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
      mermaid.initialize({ startOnLoad: true });
    </script>
  </body>
</html>
