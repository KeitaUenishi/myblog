---
import { getCollection } from "astro:content";

import FormattedDate from "../components/FormattedDate.astro";
import Pagination from "../components/Pagination.astro";
import Layout from "../layouts/Layout.astro";

const PAGE_SIZE = 30;

const allPosts = (await getCollection("blog"))
  .filter((post) => post.data.public === true)
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());

const lastPage = Math.max(1, Math.ceil(allPosts.length / PAGE_SIZE));
---

<Layout>
  <section data-page-size={PAGE_SIZE} data-last-page={lastPage}>
    <ul class="m-0 flex list-none flex-wrap gap-4 p-0" data-post-list>
      {
        allPosts.map((post, idx) => (
          <li
            class={`mb-2 w-full text-center ${idx >= PAGE_SIZE ? "hidden" : ""}`}
            data-page={Math.floor(idx / PAGE_SIZE) + 1}
          >
            <a
              href={`/blog/${post.data.id}/`}
              class="group block no-underline transition-[0.2s]"
            >
              <h4 class="group-hover:text-accent m-0 text-xl leading-tight text-black">
                {post.data.title}
              </h4>
              <p class="text-gray group-hover:text-accent m-0">
                <FormattedDate date={post.data.publishedAt} />
              </p>
            </a>
          </li>
        ))
      }
    </ul>
    <Pagination lastPage={lastPage} />
  </section>
</Layout>
